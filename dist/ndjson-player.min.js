"use strict";class Utils{static htmlNode(e){const t=Utils.newNode("template");return t.innerHTML=e.trim(),t.content.firstChild}static newNode(e){return document.createElement(e)}static node(e,t){return void 0===t&&(t=document),e instanceof Node?e:t.querySelector(e)}static isNumeric(e){return!isNaN(parseFloat(e))&&isFinite(e)}static isSelectorID(e){return 0===(e+"").trim().indexOf("#")}static isPlainObject(e){return Utils.isObject(e)&&!Utils.isArray(e)}static isObject(e){return"object"==typeof e}static isArray(e){return Array.isArray(e)}static isFunction(e){return"function"==typeof e}static isHtml(e){return-1!==(e+"").trim().indexOf("<")}static isEmpty(e){return void 0===e||Utils.isObject(e)&&0===Object.keys(e).length||""===e}}class M2D2{root;constructor(e){this.root=e.root||"body",this.template=e.template||{},this.data=e.data||[],this._init()}static _ext={};static extend(e){Object.assign(M2D2._ext,e)}update(e,t,i){const o=this;if(o._rendered){const n=function(e){let n;if(void 0!==e._node)if(Utils.isArray(e))if(void 0===i)void 0!==e[t]._node&&e[t]._node.remove();else{let t;const i=[];for(t in e._node.childNodes)n=e._node.childNodes[t],void 0!==n.tagName&&"TEMPLATE"!==n.tagName&&i.push(n);for(t in i)n=i[t],n.remove();o._doRender(e._node,e)}else{const n={};n[t]=i.value,o._doRender(e._node,Object.assign(e,n))}};void 0===t&&Utils.isFunction(o._func)?o._doFunc(o._func,e,(function(e){n(e)})):n(e)}}get(){return this._defineProp(this._data,"m2d2",this),this._setProxy(),this._data}clear(){const e=this;e._rendered&&(e.$root.innerHTML=e._cache)}$root=null;_rendered=!1;_updater=!0;_cache=null;_data=null;_func=null;_htmlGenTags=["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","datalist","dd","del","details","dfn","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","map","mark","menu","meter","nav","ol","optgroup","option","output","p","pre","progress","q","rp","rt","ruby","samp","section","select","small","span","strong","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","tr","tt","ul","var"];_init(){const e=this;if(Utils.isFunction(e._data)){e._func=e._data;let t=e._doFunc(e._func,e.param);t&&(Utils.isArray(t)&&(t={items:t}),e._data=t,e._onReady())}else Utils.isObject(e._data)||(e._data={text:e._data}),e._onReady()}_render(){const e=this;if(void 0===e._data)return console.log("data is missing in m2d2 object with root: "+e.root),!1;e._doRender(e.$root,e._data),e._rendered=!0}_onReady(){const e=this;e.$root=Utils.node(e.root),e.$root?(e._cache=e.$root.innerHTML,e._render()):console.log("Warning: Node was not found: "+e.root)}_doFunc(e,t,i){const o=this;let n=e((function(e,t,n){let s;if(void 0!==n&&Utils.isNumeric(n)?s=n:void 0!==t&&Utils.isNumeric(t)&&(s=t),Utils.isArray(e)){const i={};void 0===t||Utils.isNumeric(t)?void 0!==o.template&&(i.template=o.template):i.template=t,i.items=e,e=i}if(Utils.isPlainObject(e)){o._updater=!1;let t=1;for(let i in e)t++===Object.keys(e).length&&(o._updater=!0),o._data[i]=e[i]}void 0===s&&o.interval>0&&(s=o.interval),s>0&&(o.interval=setInterval((function(){o._func((function(e){o._doRender(o.$root,e)}))}),s)),void 0!==i&&i(e)}),t)||{};return Utils.isArray(n)&&(n={items:n}),Utils.isObject(n)||console.log("Undefined type of 'data'. For automatic detection do not set any 'return' in the data's function. Or explicitly return '[]' for arrays or '{}' for objects."),n}_setProxy(){const e=this;void 0===e._data._proxy&&(Utils.isPlainObject(e._data)||Utils.isArray(e._data))&&(e._data=e._proxy(e._data,(function(t,i,o){"m2d2"!==i&&"_"!==i[0]&&e._updater&&e.update(t,i,o)})))}_doRender(e,t){t&&void 0!==t.oninit&&Utils.isFunction(t.oninit)&&(t.oninit(),delete t.oninit),Utils.isArray(t)&&(t={items:t}),this._setProxy(),this._setValues(e,t),t&&void 0!==t.onrender&&Utils.isFunction(t.onrender)&&(t.onrender(),delete t.onrender)}_doArray(e,t,i){const o=this;o._setNode(e,i);let n=o._getTemplate(e,t);for(let s=0;s<(i.length||Object.keys(i).length);s++){let l=i[s]||Object.values(i)[s];if(void 0!==l._node&&(l._node=void 0),!n)if(Utils.isPlainObject(l)){if(1!==Object.keys(l).length)return console.log("Warning: Multiple keys in data without template is not supported yet. Object:"),void console.log(t);if(Utils.isSelectorID(l)){const e=document.querySelector(l);if(!e)return console.log("Warning: ID selector for template not found: "+l+" . Object:"),void console.log(t);n=e.outerHTML}else n=Utils.newNode(Object.keys(l)[0]).outerHTML}else if("SELECT"===e.tagName||"DATALIST"===e.tagName)n="<option>","string"==typeof l&&(l={text:l,value:l});else if("UL"===e.tagName||"OL"===e.tagName)n="<li>";else{if("NAV"!==e.tagName)return console.log("Warning: No template found for object:"),console.log(e),void console.log(t);n="<a>"}const a=Utils.htmlNode(n);a.setAttribute("data-id",s),e.append(a),o._setValues(a,l)}}_getTemplate(e,t){const i=this;if(void 0!==t._template&&""!==t._template)return t._template;{let o;if(void 0!==t.template?Utils.isPlainObject(t.template)?(o=Utils.newNode("div"),i._setValues(o,t.template)):o=Utils.isSelectorID(t.template)?document.querySelector(t.template):Utils.isHtml(t.template)?Utils.htmlNode("<template>"+t.template+"</template>"):Utils.htmlNode("<template>"+Utils.newNode(t.template).outerHTML+"</template>"):o=Utils.node("template",e),o){const e=o.innerHTML.trim();return i._defineProp(t,"_template",e),e}return e.innerHTML.trim()}}_setValues(e,t){const i=this;if(Utils.isArray(t)&&(t={items:t}),Utils.isPlainObject(t)){i._setNode(e,t),t.hasOwnProperty("html")&&null!==t.html&&i._setValue(e,"html",t.html),t.hasOwnProperty("template")?t.hasOwnProperty("items")||(t.items=[]):t.hasOwnProperty("items")&&console.log("Warning: 'items' specified but no template found.");for(let o in t){const n=t[o];if("html"===o||"template"===o||o.startsWith("_"));else if("items"===o)i._doArray(e,t,n);else if("items"!==o||Utils.isArray(n)||(console.log("Warning: 'items' specified but value is not and array in element: "),console.log(e),console.log("Passed values are: "),console.log(n)),void 0!==M2D2._ext[o]&&Utils.isFunction(M2D2._ext[o])){const t=M2D2._ext[o](n,e);t&&i._setValues(e,t)}else if("#"===o[0])i._doRender(Utils.node(o),n);else if(Utils.isArray(n)&&2===n.length&&void 0!==n[0]._node){let t=n[0]._update||null;void 0===e._orig_update&&(e._orig_update=t,n[0]._update=function(){i._data[o]=n[0][n[1]],null!==e._orig_update&&e._orig_update()}),i._setValue(e,o,n[0][n[1]])}else if("text"===o&&null!==n)i._setValue(e,o,n);else if("dataset"===o&&Utils.isPlainObject(n))for(let t in n)e.setAttribute("data-"+t,n[t]);else if("style"===o)if(Utils.isPlainObject(n))for(const t in n)e.style[t]=n[t];else e.style=n;else if(o.startsWith("on")&&Utils.isFunction(n))e[o]=n;else if(n instanceof Date)i._setValue(e,o,n);else if(!i._hasAttr(e,o)||Utils.isObject(n)||"id"===o&&Utils.isNumeric(n)){let t=Utils.node(o,e);if(!t&&(t=Utils.node("#"+o,e),t||(t=Utils.node("."+o,e)),!t&&-1!==i._htmlGenTags.indexOf(o))){const t=Utils.newNode(o);e.append(t),i._doRender(t,n);continue}t?i._doRender(t,n):console.log("No child or attribute found for: "+o)}else if("boolean"==typeof e[o]?e[o]=n:e.setAttribute(o,n),"value"===o){let t=e.onchange||null;void 0===e._orig_change&&(e._orig_change=t,e.onchange=function(){this.setAttribute(o,this.value),null!==e._orig_change&&e._orig_change()})}}}else i._setValue(e,null,t)}_setValue(e,t,i){let o=!1;if(null==t?void 0===i||null==i?(console.log("Value was undefined in element :"),console.log(e)):Utils.isPlainObject(i)&&void 0!==i.text?i=i.text:!Utils.isNumeric(i)&&Utils.isHtml(i)&&(o=!0):"html"===t&&(o=!0),o)e.innerHTML=i;else if("value"===t||null==t&&this._hasAttr(e,"value")&&"LI"!==e.tagName)this._hasAttr(e,"checked")?!0===i||"true"===i||1===i?e.setAttribute("checked",!0):!1===i||"false"===i||0===i?e.setAttribute("checked",!1):e.value=i:i instanceof Date?e.valueAsDate=i:e.value=i;else if(e.childElementCount>0){for(let t in e.childNodes){const o=e.childNodes[t];if(3===o.nodeType)return void o.replaceWith(i)}e.innerHTML=e.innerHTML+i}else e.innerText=i}_hasAttr(e,t){let i=!1;if(e&&!Utils.isNumeric(t))switch(t){case"checked":i=void 0!==e.type&&("radio"===e.type||"checkbox"===e.type);break;default:i=void 0!==e[t]||e.hasAttribute(t)}return i}_defineProp(e,t,i){Utils.isObject(e)&&void 0===e[t]&&(Object.defineProperty(e,t,{enumerable:!1,writable:!0}),e[t]=i)}_setNode(e,t){this._defineProp(t,"_node",e),this._defineProp(e,"_m2d2",t)}_proxy(e,t){this._defineProp(e,"_proxy",!0);const i={get:function(t,o,n){if("m2d2"===o||"_"===o[0])return t[o];{const s=Reflect.get(t,o,n),l=Object.getOwnPropertyDescriptor(t,o);if(l&&!l.writable&&!l.configurable)return s;try{return Utils.isArray(e)&&!Utils.isNumeric(o)?t[o]:new Proxy(t[o],i)}catch(e){return s}}},defineProperty:function(e,i,o){return t(e,i,o),Reflect.defineProperty(e,i,o)},deleteProperty:function(e,i){return t(e,i),Reflect.deleteProperty(e,i)},set:function(e,i,o){return e[i]=o,t(e,i,{value:o}),void 0!==e._update&&e._update(),!0}};return new Proxy(e,i)}set data(e){this._data=e,this.update(this._data)}get data(){return this._data}}const m2d2=function(e,t,i){const o={},n=typeof e;switch(n){case"string":if(void 0===t)return o.data=e,null;o.root=e,Utils.isArray(t)&&(t={items:t}),o.data=t,o.template=i;break;case"object":e instanceof Node&&(o.root=e,e=t);case"function":Utils.isArray(e)&&(t={items:e}),o.data=e,o.template=i;break;default:return console.log("First argument passed to m2d2, with value: ("+e+") is of unknown type: "+n),null}return new M2D2(o).get()};M2D2.extend({show:function(e,t){const i=function(){return getComputedStyle(t,null).display};if(e){if("none"===i())if(t.dataset._m2d2_display)t.style.display=t.dataset._m2d2_display;else if(t.style.removeProperty("display"),"none"===i()){const e=function(){const e=document.getElementsByTagName("body")[0],i=document.createElement("template"),o=document.createElement(t.tagName);i.appendChild(o),e.appendChild(i);const n=getComputedStyle(o,null).display;return i.remove(),n}();t.style.display=t.dataset.display||("none"!==e?e:"block")}}else{const e="none"!==t.style.display?t.style.display:i();"none"!==e&&(t.dataset._m2d2_display=e),t.style.display="none"}}}),M2D2.extend({color:function(e,t){t.style.color=e},bgcolor:function(e,t){t.style.backgroundColor=e},css:function(e,t){t.className=e},"-css":function(e,t){let i=Utils.isArray(e)?e:e.split(" ");for(let e in i)t.classList.remove(i[e])},"+css":function(e,t){let i=Utils.isArray(e)?e:e.split(" ");for(let e in i)t.classList.add(i[e])}});
function TimerSrc(e,t){let n,r,u,l,a={};a.interval=e,a.checker=50,a.status="init";let i=(new Date).getTime();return n=i-e,a.call=function(e){return t=e,a},a.nocall=function(){return t=null,a},a.exec=function(){return t&&t(),n=(new Date).getTime(),a},a.check=function(){return u&&u(),a},a.play=function(){return u=a.step,a.status="running",a},a.pause=function(){return u=null,a.status="paused",a},a.destroy=function(){for(var e in u=null,clearInterval(r),r=null,a)a[e]=null,delete a[e];a.status="destroyed"},a.step=function(){return i=(new Date).getTime(),l=Math.max(0,a.interval-(i-n)),0===l&&(l=a.interval,n=(new Date).getTime(),t&&t()),a},a.slow=function(){return a.interval=1e3,a},a.fast=function(){return a.interval=e,a},r=setInterval(a.check,a.checker),a}
class NdJsonPlayer{fps;loop;showfirst;autoplay;path;onRender;onFinish;onError;_player=null;_canvas=null;_ctx=null;_timer=null;_src="";_numFrames=0;_frames=[];_frame=0;_frameBase="";_loaded=!1;_playing=!1;_backwards=!1;_multiplier=1;constructor(t,e,s,a,r,i){const n=this;n._src=t,window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame),n.onRender=a||function(){},n.onFinish=r||function(){},n.onError=i||function(t){console.log(t)};let o=null;if(e instanceof Node)o=e;else{if("object"==typeof e)s=e,e="canvas";else if("string"!=typeof e)throw"Incorrect parameter passed to constructor of NdJsonPlayer";o=document.querySelector(e||"canvas")}if(!o)throw"Canvas element was not found in DOM: "+e;if("CANVAS"===o.tagName){n._canvas=o;const t=document.createElement("div");o.parentNode.insertBefore(t,o),t.prepend(o),o=t}else if(o.hasChildNodes()){if(n._canvas=o.querySelector("canvas"),!n._canvas)throw"No canvas found in element"}else n._canvas=document.createElement("CANVAS"),o.prepend(n._canvas);n._player=o,n._canvas.height=n._canvas.clientHeight,n._canvas.width=n._canvas.clientWidth,o.classList.add("ndjp"),n._ctx=n._canvas.getContext("2d"),n.fps=s.fps||24,n.loop=s.loop||!1,n.autoplay=s.autoplay||!1,n.showfirst=!1!==s.showfirst,n.path=s.path||"",n._timer=new TimerSrc(1e3/n.fps),n.load((function(t){void 0!==t.fb&&(n._frameBase=t.fb),void 0!==t.tf&&(n._numFrames=t.tf),void 0!==t.fps&&(n.fps=t.fps,n._timer=new TimerSrc(1e3/n.fps)),void 0!==t.f&&(n._frames.push(t),n._loaded||(n._loaded=!0,n.autoplay?n.play():n.showfirst&&n.step()))}))}load(t,e){void 0!==e&&(this._src=e,this._frames=[]);const s=new TextDecoder;let a="";return fetch(this._src).then(t=>t.body.getReader()).then(e=>e.read().then((function r({value:i,done:n}){if(n)return void t(JSON.parse(a));const o=(a+s.decode(i,{stream:!0})).split(/[\r\n](?=.)/);return a=o.pop(),o.map(JSON.parse).forEach(t),e.read().then(r)}))).catch(t=>this.onError(t))}_render(t){if(null==this._timer)throw"TimerSrc was not initialized";if(0===this._frames.length)throw"Video is empty or no frames were found";this._frame>=this._frames.length&&(this._frame=this.loop?0:this._frames.length),this._frame<0&&(this._frame=this.loop?this._frames.length-1:0),this._displayImg(t)}_displayImg(t){const e=this,s=e._frames[e._frame];e.onRender(s);const a=function(){e._timer.call((function(){t||(e._increment(),e._timer.nocall()),e._displayImg()}))};if(void 0!==s.f){const t=e._frameBase+s.f;e._image(t,a)}else a()}_increment(){this._frame+=this._multiplier*(this._backwards?-1:1),this._frame<0&&(this.loop?this._frame=this._frames.length-1:(this._frame=0,this.pause())),this._frame>this._frames.length-1&&(this.loop?this._frame=0:(this._frame=this._frames.length-1,this.pause()))}_draw=function(t,e){const s=this;return 0===t.width&&0===t.height?(t.onerror(),void 0!==e&&e(!1)):(s._ctx.save(),s._ctx.drawImage(t,0,0,t.width,t.height,0,0,s._canvas.width,s._canvas.height),s._ctx.restore(),void 0!==e&&e(!0)),this};_image=function(t,e){const s=this,a=new Image;return a.crossOrigin="",a.onload=function(){s._draw(a,(function(t){t&&void 0!==e&&e(a)}))},a.onerror=function(){const t=s.onError();t&&(a.src=t)},a.src="/"===t[0]||t.match(/^https?:/)||t.match(/^data:image/)?t:s.path+t,this};frameBase(){return this._frameBase}currentFrame(){return this._frame}totalFrames(){return this._numFrames||this._frames.length}frameAt(t){const e=this;let s=t<this.totalFrames()?e._frames[t]:null;return s&&(s.fb=e._frameBase),s}indexAt(t){return~~(t*this.totalFrames()/100)}playerNode(){return this._player}play(t){t<0?t=0:t>this._frames.length?t=this._frames.length-1:void 0!==t&&(this._frame=1*t),this._playing=!0,this._timer.play(),this._render(!1)}playForward(t){this._backwards=!1,this.play(t)}playBackwards(t){this._backwards=!0,this.play(t)}pause(){this._playing=!1,this._timer.pause()}stop(){this._playing=!1,this._frame=0,this._timer.pause(),this._displayImg(!0)}step(t){t<0?t=0:t>this._frames.length?t=this._frames.length-1:void 0!==t&&(this._frame=1*t),this._playing=!1,this._timer.step(),this._render(!0)}stepForwards(){this._backwards=!1,this.step()}stepBackwards(){this._backwards=!0,this.step()}reset(){return void 0!==this._ctx.reset&&(this._ctx.reset(),this._ctx.clear(),this.stop(),this._canvas.width=this._canvas.width),this}}
class NDJPlayer{_ndjp;_options;_ui;constructor(s,t,e,a){const n=this;this._options=Object.assign({controls:!1,play:!0,stop:!1,step:!1,progress:!0,thumbs:!0,fullscreen:!1,speed:!1,lapse:!0,frames:!0},e||{}),this._create(t),this._ndjp=new NdJsonPlayer(s,t,e,(function(s){n._onUpdate(s),void 0!==a&&a(s)}),(function(){n.stop()}),(function(s){}))}_onUpdate(s){this._ui.frames.text=this._ndjp.currentFrame()+"/"+this._ndjp.totalFrames(),this._ui.lapse.text=this._fmtTime(this._ndjp.currentFrame()/this._ndjp.fps),this._ui.progress.value=this._ndjp.currentFrame()/this._ndjp.totalFrames()*100}_create(s){const t=this;t._ui=m2d2(s,{html:t._getUI(s),play:{show:t._options.play,title:"Play",text:"▶️",href:"#",onclick:function(){return t._ndjp.play(),t._ui.play.show=!1,t._ui.pause.show=!0,!1}},pause:{show:t._options.pause,title:"Pause",text:"⏸️",href:"#",onclick:function(){return t._ndjp.pause(),t._ui.play.show=!0,t._ui.pause.show=!1,!1}},stop:{show:t._options.stop,title:"Stop",text:"⏹️",href:"#",onclick:function(){return t._ndjp.stop(),!1}},lapse:{show:t._options.lapse,title:"Time elapsed / Time Total",text:"0:00"},frames:{show:t._options.frames,title:"Current Frame / Total Frames",text:"0"},progress:{show:t._options.progress,value:0,max:100,onmousemove:function(s){let e=~~(s.offsetX/this.offsetWidth*100),a=t._ndjp.frameAt(t._ndjp.indexAt(e));if(a){t._ui.thumb.show=!0,t._ui.thumb.src=t._ndjp.frameBase()+(a.th||a.f);let e=t._ui.thumb._node;e.style.left=this.offsetLeft+s.offsetX-e.width/2+"px"}else t._ui.thumb.show=!1},onmouseleave:function(){t._ui.thumb.show=!1},onclick:function(s){let e=~~(s.offsetX/this.offsetWidth*100),a=t._ndjp.indexAt(e);t._ndjp.step(a)}},thumb:{show:!1,src:""}})}_fmtTime(s){let t=(s=s.toFixed(2)).split(".")[1]||"00";return(~~(s/60)+"").padStart(2,"0")+":"+(~~(s/60%1*60)+"").padStart(2,"0")+"."+t}_getUI(s){let t="";switch(this._options.controls){case"":case"basic":case!0:t=this._getBasicUI();break;case"common":t=this._getCommonUI();break;case"full":t=this._getFullUI()}this._options.controls;let e=s instanceof Node?s:document.querySelector(s);if(e){e.querySelector("canvas")||(t="<canvas></canvas>"+t)}else console.log("Root element: "+s+" was not found in document"),t="<canvas></canvas>"+t;return(s.innerHTML||"")+t}_getBasicUI(){return'<caption></caption>\n<div class="controls">\n<a class="play"></a>\n<a class="pause"></a>\n<label class="lapse"></label>\n<img class="thumb" />\n<progress></progress>\n</div>'}_getCommonUI(){return'<caption></caption>\n<div class="controls">\n<a class="play"></a>\n<a class="pause"></a>\n<label class="lapse"></label>\n<progress></progress>\n<label class="frames"></label>\n<img class="thumb" />\n</div>'}_getFullUI(){return'<caption></caption>\n<div class="controls">\n<a class="play"></a>\n<a class="pause"></a>\n<a class="stop"></a>\n<label class="lapse"></label>\n<progress></progress>\n<label class="frames"></label>\n<img class="thumb" />\n</div>'}}
class VideoND extends HTMLElement{constructor(){super();const t={autoplay:!1,controls:!1,loop:!1,width:"auto",height:"auto",poster:"",preload:"auto",src:"",cc:"auto",caption:"",fullscreen:!1,fps:"",speed:!1,autosize:"auto",sizes:{}||[],thumbs:"auto"},e={};for(let o in t)e[o]=this.getAttribute(o)||this.hasAttribute(o)||t[o];this.style.display="block",this.className="ndjp",this._root=this,new NDJPlayer(e.src,this,e)}setCaption(t){this._root.querySelector("caption").innerText=t}static get observedAttributes(){return["width","height","caption"]}attributeChangedCallback(t,e,o){"caption"===t&&this.setCaption(o)}}document.addEventListener("DOMContentLoaded",(function(){window.customElements.define("video-nd",VideoND)}));